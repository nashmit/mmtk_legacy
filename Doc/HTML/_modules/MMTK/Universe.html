

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MMTK.Universe &mdash; MMTK User Guide 2.7.7 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.7.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="MMTK User Guide 2.7.7 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">MMTK User Guide 2.7.7 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for MMTK.Universe</h1><div class="highlight"><pre>
<span class="c"># This module implements the various types of universes</span>
<span class="c"># (infinite, periodic etc.). A universe defines the</span>
<span class="c"># geometry of space, the force field, and external interactions</span>
<span class="c"># (boundary conditions, external fields, etc.)</span>
<span class="c">#</span>
<span class="c"># Written by Konrad Hinsen</span>
<span class="c">#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Universes</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s">&#39;restructuredtext&#39;</span>

<span class="kn">from</span> <span class="nn">MMTK</span> <span class="kn">import</span> <span class="n">Bonds</span><span class="p">,</span> <span class="n">ChemicalObjects</span><span class="p">,</span> <span class="n">Collections</span><span class="p">,</span> <span class="n">Environment</span><span class="p">,</span> \
                 <span class="n">Random</span><span class="p">,</span> <span class="n">Utility</span><span class="p">,</span> <span class="n">ParticleProperties</span><span class="p">,</span> <span class="n">Visualization</span>
<span class="kn">from</span> <span class="nn">Scientific.Geometry</span> <span class="kn">import</span> <span class="n">Transformation</span>
<span class="kn">from</span> <span class="nn">Scientific.Geometry</span> <span class="kn">import</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">isVector</span>
<span class="kn">from</span> <span class="nn">Scientific</span> <span class="kn">import</span> <span class="n">N</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">threading</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">threading</span><span class="p">,</span> <span class="s">&#39;Thread&#39;</span><span class="p">):</span>
        <span class="n">threading</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">threading</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c">#</span>
<span class="c"># The base class for all universes.</span>
<span class="c">#</span>
<div class="viewcode-block" id="Universe"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe">[docs]</a><span class="k">class</span> <span class="nc">Universe</span><span class="p">(</span><span class="n">Collections</span><span class="o">.</span><span class="n">GroupOfAtoms</span><span class="p">,</span> <span class="n">Visualization</span><span class="o">.</span><span class="n">Viewable</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Universe</span>

<span class="sd">    A universe represents a complete model of a chemical system, i.e.</span>
<span class="sd">    the molecules, their environment (topology, boundary conditions,</span>
<span class="sd">    thermostats, etc.), and optionally a force field.</span>

<span class="sd">    The class Universe is an abstract base class that defines</span>
<span class="sd">    properties common to all kinds of universes. To create universe</span>
<span class="sd">    objects, use one of its subclasses.</span>

<span class="sd">    In addition to the methods listed below, universe objects support</span>
<span class="sd">    the following operations (u is any universe object, o is any</span>
<span class="sd">    chemical object):</span>

<span class="sd">     * len(u) yields the number of chemical objects in the universe</span>
<span class="sd">     * u[i] returns object number i</span>
<span class="sd">     * u.name = o adds o to the universe and also makes it accessible as</span>
<span class="sd">       an attribute</span>
<span class="sd">     * del u.name removes the object that was assigned to u.name from</span>
<span class="sd">       the universe</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forcefield</span><span class="p">,</span> <span class="n">properties</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span> <span class="o">=</span> <span class="n">forcefield</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">properties</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="n">Collection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_environment</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_masses</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atom_properties</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bond_database</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bond_pairs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_np</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">is_universe</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">is_periodic</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">is_orthogonal</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
        <span class="n">state</span><span class="p">[</span><span class="s">&#39;_evaluator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state</span><span class="p">[</span><span class="s">&#39;_configuration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;_masses&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;_bond_database&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;_bond_pairs&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;_np&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;_spec&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">state</span><span class="p">[</span><span class="s">&#39;_np&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">state</span><span class="p">[</span><span class="s">&#39;_atoms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">state</span><span class="p">[</span><span class="s">&#39;_bond_database&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">state</span><span class="p">[</span><span class="s">&#39;_bond_pairs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_environment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;atom_properties&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_atom_properties&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;atom_properties&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s">&#39;atom_properties&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_masses</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_createSpec</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;_&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">removeObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;_&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ChemicalObjects</span><span class="o">.</span><span class="n">isChemicalObject</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                               <span class="ow">or</span> <span class="n">Environment</span><span class="o">.</span><span class="n">isEnvironmentObject</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; containing &#39;</span> <span class="o">+</span> \
               <span class="sb">`len(self._objects)`</span> <span class="o">+</span> <span class="s">&#39; objects.&#39;</span>
    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Universe.objectList"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.objectList">[docs]</a>    <span class="k">def</span> <span class="nf">objectList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">klass</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param klass: an optional class argument</span>
<span class="sd">        :type klass: class</span>
<span class="sd">        :returns: a list of all chemical objects in the universe.</span>
<span class="sd">                  If klass is given, only objects that are instances</span>
<span class="sd">                  of klass are returned.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">objectList</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.environmentObjectList"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.environmentObjectList">[docs]</a>    <span class="k">def</span> <span class="nf">environmentObjectList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">klass</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param klass: an optional class argument</span>
<span class="sd">        :type klass: class</span>
<span class="sd">        :returns: a list of all environment objects in the universe.</span>
<span class="sd">                  If klass is given, only objects that are instances</span>
<span class="sd">                  of klass are returned.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">klass</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_environment</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">klass</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">k</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_environment</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.atomList"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.atomList">[docs]</a>    <span class="k">def</span> <span class="nf">atomList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: a list of all atoms in the universe</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">atomList</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span>
</div>
    <span class="k">def</span> <span class="nf">atomIterator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">atomIterator</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">bondedUnits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">bondedUnits</span><span class="p">()</span>

<div class="viewcode-block" id="Universe.universe"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.universe">[docs]</a>    <span class="k">def</span> <span class="nf">universe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the universe itself</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="Universe.addObject"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.addObject">[docs]</a>    <span class="k">def</span> <span class="nf">addObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">steal</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds object to the universe. If object is a Collection,</span>
<span class="sd">        all elements of the Collection are added to the universe.</span>

<span class="sd">        :param object: the object (chemical or environment) to be added</span>
<span class="sd">        :param steal: if True, permit stealing the object from another</span>
<span class="sd">                      universe, otherwise the object must not yet be</span>
<span class="sd">                      attached to any universe.</span>
<span class="sd">        :type steal: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ChemicalObjects</span><span class="o">.</span><span class="n">isChemicalObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">steal</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">object</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">isUniverse</span><span class="p">(</span><span class="nb">object</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sb">`object`</span> <span class="o">+</span>
                                      <span class="s">&#39; is already in another universe&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sb">`object`</span> <span class="o">+</span> <span class="s">&#39; is part of another object&#39;</span><span class="p">)</span>
            <span class="nb">object</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_changed</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Environment</span><span class="o">.</span><span class="n">isEnvironmentObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_environment</span><span class="p">:</span>
                <span class="n">o</span><span class="o">.</span><span class="n">checkCompatibilityWith</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_environment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_changed</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Collections</span><span class="o">.</span><span class="n">isCollection</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span> \
             <span class="ow">or</span> <span class="n">Utility</span><span class="o">.</span><span class="n">isSequenceObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">object</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">steal</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; cannot be added to a universe&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.removeObject"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.removeObject">[docs]</a>    <span class="k">def</span> <span class="nf">removeObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes object from the universe. If object is a Collection,</span>
<span class="sd">        each of its elements is removed. The object to be removed must</span>
<span class="sd">        be in the universe.</span>

<span class="sd">        :param object: the object (chemical or environment) to be removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ChemicalObjects</span><span class="o">.</span><span class="n">isChemicalObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">object</span><span class="o">.</span><span class="n">parent</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sb">`object`</span> <span class="o">+</span> <span class="s">&#39; is not in this universe.&#39;</span><span class="p">)</span>
            <span class="nb">object</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">removeObject</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_changed</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Collections</span><span class="o">.</span><span class="n">isCollection</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span> \
                 <span class="ow">or</span> <span class="p">(</span><span class="n">Utility</span><span class="o">.</span><span class="n">isSequenceObject</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
                     <span class="c"># Strings are nasty because their elements are strings</span>
                     <span class="c"># as well. This creates infinite recursion without</span>
                     <span class="c"># this special-case handling.</span>
                     <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">object</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">removeObject</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Environment</span><span class="o">.</span><span class="n">isEnvironmentObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_environment</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_changed</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sb">`object`</span> <span class="o">+</span> <span class="s">&#39; is not in this universe.&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.selectShell"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.selectShell">[docs]</a>    <span class="k">def</span> <span class="nf">selectShell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param point: a point in space</span>
<span class="sd">        :type point: Scientific.Geometry.Vector</span>
<span class="sd">        :param r1: one of the radii of a spherical shell</span>
<span class="sd">        :type r1: float</span>
<span class="sd">        :param r2: the other of the two radii of a spherical shell</span>
<span class="sd">        :type r2: float</span>
<span class="sd">        :returns: a Collection of all objects in the universe whose</span>
<span class="sd">                  distance from point lies between r1 and r2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">selectShell</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.selectBox"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.selectBox">[docs]</a>    <span class="k">def</span> <span class="nf">selectBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param p1: one corner of a box in space</span>
<span class="sd">        :type p1: Scientific.Geometry.Vector</span>
<span class="sd">        :param p2: the other corner of a box in space</span>
<span class="sd">        :type p2: Scientific.Geometry.Vector</span>
<span class="sd">        :returns: a Collection of all objects in the universe that lie</span>
<span class="sd">                   within the box whose diagonally opposite corners are</span>
<span class="sd">                   given by p1 and p2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">selectBox</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system_size_changed</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bond_database</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">system_size_changed</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomList</span><span class="p">():</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">unsetArray</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_masses</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_atom_properties</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_np</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bond_pairs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_masses</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span>

<div class="viewcode-block" id="Universe.acquireReadStateLock"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.acquireReadStateLock">[docs]</a>    <span class="k">def</span> <span class="nf">acquireReadStateLock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Acquire the universe read state lock. Any application that</span>
<span class="sd">        uses threading must acquire this lock prior to accessing the</span>
<span class="sd">        current state of the universe, in particular its configuration</span>
<span class="sd">        (particle positions). This guarantees the consistency of the</span>
<span class="sd">        data; while any thread holds the read state lock, no other</span>
<span class="sd">        thread can obtain the write state lock that permits modifying</span>
<span class="sd">        the state. The read state lock should be released as soon as</span>
<span class="sd">        possible.</span>

<span class="sd">        The read state lock can be acquired only if no thread holds</span>
<span class="sd">        the write state lock. If the read state lock cannot be</span>
<span class="sd">        acquired immediately, the thread will be blocked until</span>
<span class="sd">        it becomes available. Any number of threads can acquire</span>
<span class="sd">        the read state lock simultaneously.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">stateLock</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.acquireWriteStateLock"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.acquireWriteStateLock">[docs]</a>    <span class="k">def</span> <span class="nf">acquireWriteStateLock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Acquire the universe write state lock. Any application that</span>
<span class="sd">        uses threading must acquire this lock prior to modifying the</span>
<span class="sd">        current state of the universe, in particular its configuration</span>
<span class="sd">        (particle positions). This guarantees the consistency of the</span>
<span class="sd">        data; while any thread holds the write state lock, no other</span>
<span class="sd">        thread can obtain the read state lock that permits accessing</span>
<span class="sd">        the state. The write state lock should be released as soon as</span>
<span class="sd">        possible.</span>

<span class="sd">        The write state lock can be acquired only if no other thread</span>
<span class="sd">        holds either the read state lock or the write state lock. If</span>
<span class="sd">        the write state lock cannot be acquired immediately, the</span>
<span class="sd">        thread will be blocked until it becomes available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">stateLock</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.releaseReadStateLock"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.releaseReadStateLock">[docs]</a>    <span class="k">def</span> <span class="nf">releaseReadStateLock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Release the universe read state lock.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">stateLock</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.releaseWriteStateLock"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.releaseWriteStateLock">[docs]</a>    <span class="k">def</span> <span class="nf">releaseWriteStateLock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Release the universe write state lock.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">stateLock</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.acquireConfigurationChangeLock"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.acquireConfigurationChangeLock">[docs]</a>    <span class="k">def</span> <span class="nf">acquireConfigurationChangeLock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">waitflag</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Acquire the configuration change lock. This lock should be</span>
<span class="sd">        acquired before starting an algorithm that changes the</span>
<span class="sd">        configuration continuously, e.g. minimization or molecular dynamics</span>
<span class="sd">        algorithms. This guarantees the proper order of execution when</span>
<span class="sd">        several such operations are started in succession. For example,</span>
<span class="sd">        when a minimization should be followed by a dynamics run,</span>
<span class="sd">        the use of this flag permits both operations to be started</span>
<span class="sd">        as background tasks which will be executed one after the other,</span>
<span class="sd">        permitting other threads to run in parallel.</span>

<span class="sd">        The configuration change lock should not be confused with</span>
<span class="sd">        the universe state lock. The former guarantees the proper</span>
<span class="sd">        sequence of long-running algorithms, whereas the latter</span>
<span class="sd">        guarantees the consistency of the data. A dynamics algorithm,</span>
<span class="sd">        for example, keeps the configuration change lock from the</span>
<span class="sd">        beginning to the end, but acquires the universe state lock</span>
<span class="sd">        only immediately before modifying configuration and velocities,</span>
<span class="sd">        and releases it immediately afterwards.</span>

<span class="sd">        :param waitflag: if true, the method waits until the lock</span>
<span class="sd">                         becomes available; this is the most common mode.</span>
<span class="sd">                         If false, the method returns immediately even</span>
<span class="sd">                         if another thread holds the lock.</span>
<span class="sd">        :type waitflag: bool</span>
<span class="sd">        :returns: a flag indicating if the lock was successfully</span>
<span class="sd">                  acquired (1) or not (0).</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">waitflag</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">configurationChangeLock</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">configurationChangeLock</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.releaseConfigurationChangeLock"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.releaseConfigurationChangeLock">[docs]</a>    <span class="k">def</span> <span class="nf">releaseConfigurationChangeLock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Releases the configuration change lock.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">configurationChangeLock</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.setForceField"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.setForceField">[docs]</a>    <span class="k">def</span> <span class="nf">setForceField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forcefield</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param forcefield: the new forcefield for this universe</span>
<span class="sd">        :type forcefield: :class:`~MMTK.ForceFields.ForceField.ForceField`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span> <span class="o">=</span> <span class="n">forcefield</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bond_database</span> <span class="o">=</span> <span class="bp">None</span>
</div>
    <span class="k">def</span> <span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ChemicalObjects</span><span class="o">.</span><span class="n">isChemicalObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">isVector</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">numberOfAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">numberOfAtoms</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">numberOfPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_np</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_np</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="n">GroupOfAtoms</span><span class="o">.</span><span class="n">numberOfPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_np</span>

    <span class="n">numberOfCartesianCoordinates</span> <span class="o">=</span> <span class="n">numberOfPoints</span>

<div class="viewcode-block" id="Universe.configuration"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.configuration">[docs]</a>    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the configuration object describing the current</span>
<span class="sd">                  configuration of the universe. Note that this is not a</span>
<span class="sd">                  copy of the current state, but a reference: the positions</span>
<span class="sd">                  in the configuration object will change when coordinate</span>
<span class="sd">                  changes are applied to the universe in whatever way.</span>
<span class="sd">        :rtype: :class:`~MMTK.ParticleProperties.Configuration`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfAtoms</span><span class="p">()</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">N</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
            <span class="n">index_map</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">redef</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomList</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">a</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="p">:</span>
                    <span class="n">redef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">index_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">index_map</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">redef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">free_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">np</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">index_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">free_indices</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">redef</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">redef</span><span class="p">,</span> <span class="n">free_indices</span><span class="p">):</span>
                <span class="n">a</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="c"># At this point a.index runs from 0 to np-1 in the universe.</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomList</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">array</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">coordinates</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">array</span>
                        <span class="k">del</span> <span class="n">a</span><span class="o">.</span><span class="n">pos</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="n">coordinates</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Utility</span><span class="o">.</span><span class="n">undefined</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">coordinates</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">coordinates</span>
            <span class="c"># Define configuration object.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># a hack to prevent endless recursion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> \
                         <span class="n">ParticleProperties</span><span class="o">.</span><span class="n">Configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span>
</div>
<div class="viewcode-block" id="Universe.copyConfiguration"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.copyConfiguration">[docs]</a>    <span class="k">def</span> <span class="nf">copyConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This operation is thread-safe; it won&#39;t return inconsistent</span>
<span class="sd">        data even when another thread is modifying the configuration.</span>

<span class="sd">        :returns: a copy of the current configuration</span>
<span class="sd">        :rtype: :class:`~MMTK.ParticleProperties.Configuration`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acquireReadStateLock</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">())</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">releaseReadStateLock</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">conf</span>
</div>
    <span class="k">def</span> <span class="nf">atomNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfAtoms</span><span class="p">()</span><span class="o">*</span><span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomList</span><span class="p">():</span>
            <span class="n">names</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">fullName</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">names</span>

<div class="viewcode-block" id="Universe.setConfiguration"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.setConfiguration">[docs]</a>    <span class="k">def</span> <span class="nf">setConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the current configuration of the universe by copying</span>
<span class="sd">        the given input configuration.</span>
<span class="sd">        </span>
<span class="sd">        :param configuration: the new configuration</span>
<span class="sd">        :type configuration: :class:`~MMTK.ParticleProperties.Configuration`</span>
<span class="sd">        :param block: if True, the operation blocks other threads</span>
<span class="sd">                      from accessing the configuration before the update</span>
<span class="sd">                      is completed. If False, it is assumed that the</span>
<span class="sd">                      caller takes care of locking.</span>
<span class="sd">        :type block: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ParticleProperties</span><span class="o">.</span><span class="n">isConfiguration</span><span class="p">(</span><span class="n">configuration</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;not a universe configuration&#39;</span><span class="p">)</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acquireWriteStateLock</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">conf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCellParameters</span><span class="p">(</span><span class="n">configuration</span><span class="o">.</span><span class="n">cell_parameters</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">releaseWriteStateLock</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Universe.addToConfiguration"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.addToConfiguration">[docs]</a>    <span class="k">def</span> <span class="nf">addToConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">displacement</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the current configuration of the universe by adding</span>
<span class="sd">        the given displacement vector.</span>
<span class="sd">        </span>
<span class="sd">        :param displacement: the displacement vector for each atom</span>
<span class="sd">        :type displacement: :class:`~MMTK.ParticleProperties.ParticleVector`</span>
<span class="sd">        :param block: if True, the operation blocks other threads</span>
<span class="sd">                      from accessing the configuration before the update</span>
<span class="sd">                      is completed. If False, it is assumed that the</span>
<span class="sd">                      caller takes care of locking.</span>
<span class="sd">        :type block: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acquireWriteStateLock</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">conf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">conf</span><span class="o">+</span><span class="n">displacement</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">releaseWriteStateLock</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Universe.getParticleScalar"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.getParticleScalar">[docs]</a>    <span class="k">def</span> <span class="nf">getParticleScalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">datatype</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">Float</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param name: the name of an atom attribute</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param datatype: the datatype of the array allocated to hold the data</span>
<span class="sd">        :returns: the values of the attribute &#39;name&#39; for each atom</span>
<span class="sd">                  in the universe.</span>
<span class="sd">        :rtype: :class:`~MMTK.ParticleProperties.ParticleScalar`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">conf</span><span class="p">),),</span> <span class="n">datatype</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomList</span><span class="p">():</span>
            <span class="n">array</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ParticleProperties</span><span class="o">.</span><span class="n">ParticleScalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span></div>
    <span class="n">getAtomScalarArray</span> <span class="o">=</span> <span class="n">getParticleScalar</span>

<div class="viewcode-block" id="Universe.getParticleBoolean"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.getParticleBoolean">[docs]</a>    <span class="k">def</span> <span class="nf">getParticleBoolean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param name: the name of an atom attribute</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :returns: the values of the boolean attribute &#39;name&#39; for each atom</span>
<span class="sd">                  in the universe, or False for atoms that do not have</span>
<span class="sd">                  the attribute.</span>
<span class="sd">        :rtype: :class:`~MMTK.ParticleProperties.ParticleScalar`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">conf</span><span class="p">),),</span> <span class="n">N</span><span class="o">.</span><span class="n">Int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomList</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">array</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="k">return</span> <span class="n">ParticleProperties</span><span class="o">.</span><span class="n">ParticleScalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span></div>
    <span class="n">getAtomBooleanArray</span> <span class="o">=</span> <span class="n">getParticleBoolean</span>

<div class="viewcode-block" id="Universe.masses"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.masses">[docs]</a>    <span class="k">def</span> <span class="nf">masses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the masses of all atoms in the universe</span>
<span class="sd">        :rtype: :class:`~MMTK.ParticleProperties.ParticleScalar`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masses</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_masses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParticleScalar</span><span class="p">(</span><span class="s">&#39;_mass&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masses</span>
</div>
<div class="viewcode-block" id="Universe.charges"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.charges">[docs]</a>    <span class="k">def</span> <span class="nf">charges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the atomic charges defined by the universe&#39;s</span>
<span class="sd">        force field.</span>

<span class="sd">        :returns: the charges of all atoms in the universe</span>
<span class="sd">        :rtype: :class:`~MMTK.ParticleProperties.ParticleScalar`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span>
        <span class="k">if</span> <span class="n">ff</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;no force field defined&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ff</span><span class="o">.</span><span class="n">charges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.velocities"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.velocities">[docs]</a>    <span class="k">def</span> <span class="nf">velocities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the current velocities of all atoms, or None if</span>
<span class="sd">                  no velocities are defined. Note that this is not a</span>
<span class="sd">                  copy of the current state but a reference to it;</span>
<span class="sd">                  its data will change whenever any changes are made</span>
<span class="sd">                  to the current velocities.</span>
<span class="sd">        :rtype: :class:`~MMTK.ParticleProperties.ParticleVector`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atom_properties</span><span class="p">[</span><span class="s">&#39;velocity&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Universe.setVelocities"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.setVelocities">[docs]</a>    <span class="k">def</span> <span class="nf">setVelocities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocities</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the current velocities of the universe by copying</span>
<span class="sd">        the given input velocities.</span>
<span class="sd">        </span>
<span class="sd">        :param velocities: the new velocities, or None to remove</span>
<span class="sd">                           the velocity definition from the universe</span>
<span class="sd">        :type velocities: :class:`~MMTK.ParticleProperties.ParticleVector`</span>
<span class="sd">        :param block: if True, the operation blocks other threads</span>
<span class="sd">                      from accessing the configuration before the update</span>
<span class="sd">                      is completed. If False, it is assumed that the</span>
<span class="sd">                      caller takes care of locking.</span>
<span class="sd">        :type block: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">velocities</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atom_properties</span><span class="p">[</span><span class="s">&#39;velocity&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atom_properties</span><span class="p">[</span><span class="s">&#39;velocity&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">ParticleProperties</span><span class="o">.</span><span class="n">ParticleVector</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_atom_properties</span><span class="p">[</span><span class="s">&#39;velocity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acquireWriteStateLock</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">velocities</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">releaseWriteStateLock</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Universe.initializeVelocitiesToTemperature"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.initializeVelocitiesToTemperature">[docs]</a>    <span class="k">def</span> <span class="nf">initializeVelocitiesToTemperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temperature</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate random velocities for all atoms from a Boltzmann</span>
<span class="sd">        distribution.</span>

<span class="sd">        :param temperature: the reference temperature for the Boltzmann</span>
<span class="sd">                            distribution</span>
<span class="sd">        :type temperature: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="n">masses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masses</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atom_properties</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;velocity&#39;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atom_properties</span><span class="p">[</span><span class="s">&#39;velocity&#39;</span><span class="p">]</span>
        <span class="n">fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParticleBoolean</span><span class="p">(</span><span class="s">&#39;fixed&#39;</span><span class="p">)</span>
        <span class="n">np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfPoints</span><span class="p">()</span>
        <span class="n">velocities</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">N</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">np</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">masses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fixed</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">velocities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Random</span><span class="o">.</span><span class="n">randomVelocity</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span>
                                                           <span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atom_properties</span><span class="p">[</span><span class="s">&#39;velocity&#39;</span><span class="p">]</span> <span class="o">=</span> \
                          <span class="n">ParticleProperties</span><span class="o">.</span><span class="n">ParticleVector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocities</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjustVelocitiesToConstraints</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Universe.scaleVelocitiesToTemperature"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.scaleVelocitiesToTemperature">[docs]</a>    <span class="k">def</span> <span class="nf">scaleVelocitiesToTemperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale all velocities by a common factor in order to obtain</span>
<span class="sd">        the specified temperature.</span>

<span class="sd">        :param temperature: the reference temperature</span>
<span class="sd">        :type temperature: float</span>
<span class="sd">        :param block: if True, the operation blocks other threads</span>
<span class="sd">                      from accessing the configuration before the update</span>
<span class="sd">                      is completed. If False, it is assumed that the</span>
<span class="sd">                      caller takes care of locking.</span>
<span class="sd">        :type block: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">velocities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocities</span><span class="p">()</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acquireWriteStateLock</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">velocities</span><span class="o">.</span><span class="n">scaleBy</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">releaseWriteStateLock</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">degreesOfFreedom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GroupOfAtoms</span><span class="o">.</span><span class="n">degreesOfFreedom</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> \
               <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfDistanceConstraints</span><span class="p">()</span>

<div class="viewcode-block" id="Universe.distanceConstraintList"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.distanceConstraintList">[docs]</a>    <span class="k">def</span> <span class="nf">distanceConstraintList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the list of distance constraints</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">distanceConstraintList</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Universe.numberOfDistanceConstraints"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.numberOfDistanceConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">numberOfDistanceConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the number of distance constraints</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">numberOfDistanceConstraints</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Universe.setBondConstraints"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.setBondConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">setBondConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets distance constraints for all bonds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">setBondConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enforceConstraints</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Universe.removeDistanceConstraints"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.removeDistanceConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">removeDistanceConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes all distance constraints.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">removeDistanceConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.enforceConstraints"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.enforceConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">enforceConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">velocities</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enforces the previously defined distance constraints</span>
<span class="sd">        by modifying the configuration and velocities.</span>

<span class="sd">        :param configuration: the configuration in which the</span>
<span class="sd">                              constraints are enforced</span>
<span class="sd">                              (None for current configuration)</span>
<span class="sd">        :type configuration: :class:`~MMTK.ParticleProperties.Configuration`</span>
<span class="sd">        :param velocities: the velocities in which the</span>
<span class="sd">                              constraints are enforced</span>
<span class="sd">                              (None for current velocities)</span>
<span class="sd">        :type velocities: :class:`~MMTK.ParticleProperties.ParticleVector`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">MMTK</span> <span class="kn">import</span> <span class="n">Dynamics</span>
        <span class="n">Dynamics</span><span class="o">.</span><span class="n">enforceConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjustVelocitiesToConstraints</span><span class="p">(</span><span class="n">velocities</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.adjustVelocitiesToConstraints"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.adjustVelocitiesToConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">adjustVelocitiesToConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocities</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the velocities to be compatible with</span>
<span class="sd">        the distance constraints, i.e. projects out the velocity</span>
<span class="sd">        components along the constrained distances.</span>

<span class="sd">        :param velocities: the velocities in which the</span>
<span class="sd">                              constraints are enforced</span>
<span class="sd">                              (None for current velocities)</span>
<span class="sd">        :type velocities: :class:`~MMTK.ParticleProperties.ParticleVector`</span>
<span class="sd">        :param block: if True, the operation blocks other threads</span>
<span class="sd">                      from accessing the configuration before the update</span>
<span class="sd">                      is completed. If False, it is assumed that the</span>
<span class="sd">                      caller takes care of locking.</span>
<span class="sd">        :type block: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">MMTK</span> <span class="kn">import</span> <span class="n">Dynamics</span>
        <span class="k">if</span> <span class="n">velocities</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">velocities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocities</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">velocities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acquireWriteStateLock</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Dynamics</span><span class="o">.</span><span class="n">projectVelocities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocities</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">releaseWriteStateLock</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">bondLengthDatabase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bond_database</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bond_database</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bond_database</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_bond_database</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">bondLengthDatabase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bond_database</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bond_database</span> <span class="o">=</span> <span class="n">Bonds</span><span class="o">.</span><span class="n">DummyBondLengthDatabase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bond_database</span>

<div class="viewcode-block" id="Universe.forcefield"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.forcefield">[docs]</a>    <span class="k">def</span> <span class="nf">forcefield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the force field</span>
<span class="sd">        :rtype: :class:`~MMTK.ForceFields.ForceField.ForceField`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span>
</div>
    <span class="k">def</span> <span class="nf">energyEvaluatorParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset1</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">subset2</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">MMTK.ForceFields</span> <span class="kn">import</span> <span class="n">ForceField</span>
        <span class="n">ffdata</span> <span class="o">=</span> <span class="n">ForceField</span><span class="o">.</span><span class="n">ForceFieldData</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span><span class="o">.</span><span class="n">evaluatorParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset1</span><span class="p">,</span> <span class="n">subset2</span><span class="p">,</span>
                                                    <span class="n">ffdata</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">energyEvaluator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset1</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">subset2</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                        <span class="n">threads</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mpi_communicator</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;no force field defined&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span><span class="p">[(</span><span class="n">subset1</span><span class="p">,</span> <span class="n">subset2</span><span class="p">,</span> <span class="n">threads</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">MMTK.ForceFields</span> <span class="kn">import</span> <span class="n">ForceField</span>
            <span class="nb">eval</span> <span class="o">=</span> <span class="n">ForceField</span><span class="o">.</span><span class="n">EnergyEvaluator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span><span class="p">,</span>
                                              <span class="n">subset1</span><span class="p">,</span> <span class="n">subset2</span><span class="p">,</span>
                                              <span class="n">threads</span><span class="p">,</span> <span class="n">mpi_communicator</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluator</span><span class="p">[(</span><span class="n">subset1</span><span class="p">,</span> <span class="n">subset2</span><span class="p">,</span> <span class="n">threads</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">eval</span>
        <span class="k">return</span> <span class="nb">eval</span>

<div class="viewcode-block" id="Universe.energy"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.energy">[docs]</a>    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset1</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">subset2</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">small_change</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param subset1: a subset of a universe, or None</span>
<span class="sd">        :type subset1: :class:`~MMTK.ChemicalObjects.ChemicalObject`</span>
<span class="sd">        :param subset2: a subset of a universe, or None</span>
<span class="sd">        :type subset2: :class:`~MMTK.ChemicalObjects.ChemicalObject`</span>
<span class="sd">        :param small_change: if True, algorithms optimized for small</span>
<span class="sd">                             configurational changes relative to the last</span>
<span class="sd">                             evaluation may be used.</span>
<span class="sd">        :type small_change: bool</span>
<span class="sd">        :returns: the potential energy of interaction between the atoms</span>
<span class="sd">                  in subset1 and the atoms in subset2. If subset2 is None,</span>
<span class="sd">                  the interactions within subset1 are calculated. It both</span>
<span class="sd">                  subsets are None, the potential energy of the whole</span>
<span class="sd">                  universe is returned.</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energyEvaluator</span><span class="p">(</span><span class="n">subset1</span><span class="p">,</span> <span class="n">subset2</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">small_change</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.energyAndGradients"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.energyAndGradients">[docs]</a>    <span class="k">def</span> <span class="nf">energyAndGradients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset1</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">subset2</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                           <span class="n">small_change</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the energy and the energy gradients</span>
<span class="sd">        :rtype: (float, :class:`~MMTK.ParticleProperties.ParticleVector`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energyEvaluator</span><span class="p">(</span><span class="n">subset1</span><span class="p">,</span> <span class="n">subset2</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">small_change</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.energyAndForceConstants"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.energyAndForceConstants">[docs]</a>    <span class="k">def</span> <span class="nf">energyAndForceConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset1</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">subset2</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                                <span class="n">small_change</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the energy and the force constants</span>
<span class="sd">        :rtype: (float, :class:`~MMTK.ParticleProperties.SymmetricPairTensor`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energyEvaluator</span><span class="p">(</span><span class="n">subset1</span><span class="p">,</span> <span class="n">subset2</span><span class="p">)</span>
        <span class="n">e</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">fc</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">small_change</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">e</span><span class="p">,</span> <span class="n">fc</span>
</div>
<div class="viewcode-block" id="Universe.energyGradientsAndForceConstants"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.energyGradientsAndForceConstants">[docs]</a>    <span class="k">def</span> <span class="nf">energyGradientsAndForceConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset1</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">subset2</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                                         <span class="n">small_change</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the energy, its gradients, and the force constants</span>
<span class="sd">        :rtype: (float, :class:`~MMTK.ParticleProperties.ParticleVector`,</span>
<span class="sd">                 :class:`~MMTK.ParticleProperties.SymmetricPairTensor`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energyEvaluator</span><span class="p">(</span><span class="n">subset1</span><span class="p">,</span> <span class="n">subset2</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">small_change</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.energyTerms"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.energyTerms">[docs]</a>    <span class="k">def</span> <span class="nf">energyTerms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset1</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">subset2</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">small_change</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: a dictionary containing the energy values for each</span>
<span class="sd">                  energy term separately. The energy terms are defined by the</span>
<span class="sd">                  force field.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energyEvaluator</span><span class="p">(</span><span class="n">subset1</span><span class="p">,</span> <span class="n">subset2</span><span class="p">)</span>
        <span class="nb">eval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">small_change</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="o">.</span><span class="n">lastEnergyTerms</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Universe.configurationDifference"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.configurationDifference">[docs]</a>    <span class="k">def</span> <span class="nf">configurationDifference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf1</span><span class="p">,</span> <span class="n">conf2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param conf1: a configuration</span>
<span class="sd">        :type conf1: :class:`~MMTK.ParticleProperties.Configuration`</span>
<span class="sd">        :param conf2: a configuration</span>
<span class="sd">        :type conf2: :class:`~MMTK.ParticleProperties.Configuration`</span>
<span class="sd">        :returns: the difference vector between the two configurations</span>
<span class="sd">                  for each atom, taking into account the universe</span>
<span class="sd">                  topology (e.g. minimum-image convention).</span>
<span class="sd">        :rtype: :class:`~MMTK.ParticleProperties.ParticleVector`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">conf2</span><span class="o">-</span><span class="n">conf1</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">conf1</span><span class="o">.</span><span class="n">cell_parameters</span>
        <span class="k">if</span> <span class="n">cell</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">foldCoordinatesIntoBox</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>
            </div>
<div class="viewcode-block" id="Universe.distanceVector"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.distanceVector">[docs]</a>    <span class="k">def</span> <span class="nf">distanceVector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param p1: a vector or a chemical object whose position is taken</span>
<span class="sd">        :param p2: a vector or a chemical object whose position is taken</span>
<span class="sd">        :param conf: a configuration (None for the current configuration)</span>
<span class="sd">        :returns: the distance vector between p1 and p2 (i.e. the</span>
<span class="sd">                  vector from p1 to p2) in the configuration conf,</span>
<span class="sd">                  taking into account the universe&#39;s topology.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">distanceVector</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">array</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fixCellParameters</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">cell_parameters</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cell</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">distanceVector</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">array</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">distanceVector</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                                                        <span class="n">cell</span><span class="p">))</span>
            </div>
<div class="viewcode-block" id="Universe.distance"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.distance">[docs]</a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param p1: a vector or a chemical object whose position is taken</span>
<span class="sd">        :param p2: a vector or a chemical object whose position is taken</span>
<span class="sd">        :param conf: a configuration (None for the current configuration)</span>
<span class="sd">        :returns: the distance between p1 and p2, i.e. the length</span>
<span class="sd">                  of the distance vector</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">distanceVector</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Universe.angle"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.angle">[docs]</a>    <span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param p1: a vector or a chemical object whose position is taken</span>
<span class="sd">        :param p2: a vector or a chemical object whose position is taken</span>
<span class="sd">        :param p3: a vector or a chemical object whose position is taken</span>
<span class="sd">        :param conf: a configuration (None for the current configuration)</span>
<span class="sd">        :returns: the angle between the distance vectors p1-p2 and p3-p2</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distanceVector</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distanceVector</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v1</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.dihedral"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.dihedral">[docs]</a>    <span class="k">def</span> <span class="nf">dihedral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param p1: a vector or a chemical object whose position is taken</span>
<span class="sd">        :param p2: a vector or a chemical object whose position is taken</span>
<span class="sd">        :param p3: a vector or a chemical object whose position is taken</span>
<span class="sd">        :param p4: a vector or a chemical object whose position is taken</span>
<span class="sd">        :param conf: a configuration (None for the current configuration)</span>
<span class="sd">        :returns: the dihedral angle between the plane containing the</span>
<span class="sd">                  distance vectors p1-p2 and p3-p2 and the plane containing</span>
<span class="sd">                  the distance vectors p2-p3 and p4-p3</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distanceVector</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distanceVector</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>
        <span class="n">v3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distanceVector</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="o">.</span><span class="n">normal</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">v3</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="o">.</span><span class="n">normal</span><span class="p">()</span>
        <span class="n">cos</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span>
        <span class="n">sin</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">v2</span><span class="o">/</span><span class="n">v2</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Transformation</span><span class="o">.</span><span class="n">angleFromSineAndCosine</span><span class="p">(</span><span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_deleteAtom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="Universe.basisVectors"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.basisVectors">[docs]</a>    <span class="k">def</span> <span class="nf">basisVectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the basis vectors of the elementary cell of a periodic</span>
<span class="sd">                  universe, or None for a non-periodic universe</span>
<span class="sd">        :rtype: NoneType or list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Universe.reciprocalBasisVectors"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.reciprocalBasisVectors">[docs]</a>    <span class="k">def</span> <span class="nf">reciprocalBasisVectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the reciprocal basis vectors of the elementary cell of</span>
<span class="sd">                  a periodic universe, or None for a non-periodic universe</span>
<span class="sd">        :rtype: NoneType or list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
    <span class="k">def</span> <span class="nf">cellParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">setCellParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;incompatible cell parameters&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fixCellParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_parameters</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cell_parameters</span>

<div class="viewcode-block" id="Universe.cellVolume"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.cellVolume">[docs]</a>    <span class="k">def</span> <span class="nf">cellVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the volume of the elementary cell of a periodic</span>
<span class="sd">                  universe, None for a non-periodic universe</span>
<span class="sd">        :rtype: NoneType or float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Universe.largestDistance"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.largestDistance">[docs]</a>    <span class="k">def</span> <span class="nf">largestDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: the largest possible distance between any two points</span>
<span class="sd">                  that can be represented independent of orientation, i.e. the</span>
<span class="sd">                  radius of the largest sphere that fits into the simulation</span>
<span class="sd">                  cell. Returns None if no such upper limit exists.</span>
<span class="sd">        :rtype: NoneType or float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Universe.contiguousObjectOffset"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.contiguousObjectOffset">[docs]</a>    <span class="k">def</span> <span class="nf">contiguousObjectOffset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                               <span class="n">box_coordinates</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param objects: a list of chemical objects, or None for all</span>
<span class="sd">                        objects in the universe</span>
<span class="sd">        :type objects: list</span>
<span class="sd">        :param conf: a configuration (None for the current configuration)</span>
<span class="sd">        :param box_coordinates: use box coordinates rather than real ones</span>
<span class="sd">        :type box_coordinates: bool</span>
<span class="sd">        :returns: a set of displacement vectors relative to</span>
<span class="sd">                  the conf which, when added to the configuration,</span>
<span class="sd">                  create a configuration in which none of the objects</span>
<span class="sd">                  is split across the edge of the elementary cell.</span>
<span class="sd">                  For nonperiodic universes the return value is None.</span>
<span class="sd">        :rtype: :class:`~MMTK.ParticleProperties.ParticleVector`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Universe.contiguousObjectConfiguration"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.contiguousObjectConfiguration">[docs]</a>    <span class="k">def</span> <span class="nf">contiguousObjectConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param objects: a list of chemical objects, or None for all</span>
<span class="sd">                        objects in the universe</span>
<span class="sd">        :type objects: list</span>
<span class="sd">        :param conf: a configuration (None for the current configuration)</span>
<span class="sd">        :returns: configuration conf (default: current configuration)</span>
<span class="sd">                  corrected by the contiguous object offsets for that</span>
<span class="sd">                  configuration.</span>
<span class="sd">        :rtype: :class:`~MMTK.ParticleProperties.Configuration`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contiguousObjectOffset</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">conf</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.realToBoxCoordinates"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.realToBoxCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">realToBoxCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Box coordinates are defined only for periodic universes;</span>
<span class="sd">        their components have values between -0.5 and 0.5; these</span>
<span class="sd">        extreme values correspond to the walls of the simulation box.</span>

<span class="sd">        :param vector: a point in the universe</span>
<span class="sd">        :returns: the box coordinate equivalent of vector, or the original</span>
<span class="sd">                  vector if no box coordinate system exists</span>
<span class="sd">        :rtype: Scientific.Geometry.Vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">vector</span>
    </div>
<div class="viewcode-block" id="Universe.boxToRealCoordinates"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.boxToRealCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">boxToRealCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param vector: a point in the universe expressed in box coordinates</span>
<span class="sd">        :returns: the real-space equivalent of vector</span>
<span class="sd">        :rtype: Scientific.Geometry.Vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">vector</span>
</div>
    <span class="k">def</span> <span class="nf">_realToBoxPointArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">array</span>

    <span class="k">def</span> <span class="nf">_boxToRealPointArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">array</span>

<div class="viewcode-block" id="Universe.cartesianToFractional"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.cartesianToFractional">[docs]</a>    <span class="k">def</span> <span class="nf">cartesianToFractional</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fractional coordinates are defined only for periodic universes;</span>
<span class="sd">        their components have values between 0. and 1.</span>

<span class="sd">        :param vector: a point in the universe</span>
<span class="sd">        :type vector: Scientific.Geometry.Vector</span>
<span class="sd">        :returns: the fractional coordinate equivalent of vector</span>
<span class="sd">        :rtype: Scientific.N.array_type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Universe is not periodic&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">cartesianToFractionalMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Universe is not periodic&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Universe.fractionalToCartesian"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.fractionalToCartesian">[docs]</a>    <span class="k">def</span> <span class="nf">fractionalToCartesian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fractional coordinates are defined only for periodic universes;</span>
<span class="sd">        their components have values between 0. and 1.</span>

<span class="sd">        :param array: an array of fractional coordinates</span>
<span class="sd">        :type array: Scientific.N.array_type</span>
<span class="sd">        :returns: the real-space equivalent of vector</span>
<span class="sd">        :rtype: Scientific.Geometry.Vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Universe is not periodic&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">fractionalToCartesianMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Universe is not periodic&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">foldCoordinatesIntoBox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span>

<div class="viewcode-block" id="Universe.randomPoint"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.randomPoint">[docs]</a>    <span class="k">def</span> <span class="nf">randomPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: a random point from a uniform distribution within</span>
<span class="sd">                  the universe. This operation is defined only for</span>
<span class="sd">                  finite-volume universes, e.g. periodic universes.</span>
<span class="sd">        :rtype: Scientific.Geometry.Vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;undefined operation&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Universe.map"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.map">[docs]</a>    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a function to all objects in the universe and</span>
<span class="sd">        return the list of the results. If the results are chemical</span>
<span class="sd">        objects, a Collection object is returned instead of a list.</span>

<span class="sd">        :param function: the function to be applied</span>
<span class="sd">        :type function: callable</span>
<span class="sd">        :returns: the list or collection of the results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">index_map</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">objects</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">objects</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;_&#39;</span><span class="p">:</span>
                <span class="nb">object</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ChemicalObjects</span><span class="o">.</span><span class="n">isChemicalObject</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span> \
                   <span class="ow">or</span> <span class="n">Environment</span><span class="o">.</span><span class="n">isEnvironmentObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
                    <span class="n">attributes</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objects</span><span class="o">.</span><span class="n">objectList</span><span class="p">():</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">description</span><span class="p">(</span><span class="n">index_map</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_environment</span><span class="p">:</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">description</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">classname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classname_for_trajectories</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">classname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;c(</span><span class="si">%s</span><span class="s">,[</span><span class="si">%s</span><span class="s">])&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="sb">`classname + self._descriptionArguments()`</span><span class="p">,</span>
             <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">_graphics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">distance_fn</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">_graphics</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">distance_fn</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span>
                                       <span class="n">module</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

<div class="viewcode-block" id="Universe.setFromTrajectory"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.Universe.setFromTrajectory">[docs]</a>    <span class="k">def</span> <span class="nf">setFromTrajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the state of the universe to the one stored in a trajectory.</span>
<span class="sd">        This operation is thread-safe; it blocks other threads that</span>
<span class="sd">        want to access the configuration or velocities while the data is</span>
<span class="sd">        being updated.</span>

<span class="sd">        :param trajectory: a trajectory object for this universe</span>
<span class="sd">        :type trajectory: :class:`~MMTK.Trajectory.Trajectory`</span>
<span class="sd">        :param step: a step number, or None for the default step</span>
<span class="sd">                     (0 for a standard trajectory, the last written</span>
<span class="sd">                     step for a restart trajectory)</span>
<span class="sd">        :type step: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">defaultStep</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acquireWriteStateLock</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setConfiguration</span><span class="p">(</span><span class="n">trajectory</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="n">step</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">vel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocities</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vel_tr</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">velocities</span><span class="p">[</span><span class="n">step</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">vel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">Utility</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;velocities were not modified because &quot;</span> <span class="o">+</span>
                                    <span class="s">&quot;the trajectory does not contain &quot;</span> <span class="o">+</span>
                                    <span class="s">&quot;velocity data.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">vel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_atom_properties</span><span class="p">[</span><span class="s">&#39;velocity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vel_tr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vel</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">vel_tr</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">releaseWriteStateLock</span><span class="p">()</span>

    <span class="c">#</span>
    <span class="c"># More efficient reimplementations of methods in Collections.GroupOfAtoms</span>
    <span class="c">#</span></div>
    <span class="k">def</span> <span class="nf">numberOfFixedAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParticleBoolean</span><span class="p">(</span><span class="s">&#39;fixed&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sumOverParticles</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">degreesOfFreedom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numberOfAtoms</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">numberOfFixedAtoms</span><span class="p">())</span> \
               <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfDistanceConstraints</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">mass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">masses</span><span class="p">()</span><span class="o">.</span><span class="n">sumOverParticles</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">centerOfMass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masses</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">conf</span><span class="p">)</span><span class="o">.</span><span class="n">sumOverParticles</span><span class="p">()</span><span class="o">/</span><span class="n">m</span><span class="o">.</span><span class="n">sumOverParticles</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">kineticEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocities</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">velocities</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">velocities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocities</span><span class="p">()</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">velocities</span><span class="o">.</span><span class="n">massWeightedDotProduct</span><span class="p">(</span><span class="n">velocities</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">momentum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocities</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">velocities</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">velocities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocities</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">masses</span><span class="p">()</span><span class="o">*</span><span class="n">velocities</span><span class="p">)</span><span class="o">.</span><span class="n">sumOverParticles</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">translateBy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">array</span>
        <span class="n">N</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">vector</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">N</span><span class="o">.</span><span class="n">NewAxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">conf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">applyTransformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">array</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">rotation</span><span class="p">()</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">array</span>
        <span class="n">conf</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">rot</span><span class="p">))</span>
        <span class="n">N</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">translation</span><span class="p">()</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">N</span><span class="o">.</span><span class="n">NewAxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">conf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">writeXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">):</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot; &#39;</span> <span class="o">+</span>
                   <span class="s">&#39;standalone=&quot;yes&quot;?&gt;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;molecularsystem&gt;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;templates&gt;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">memo</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="nb">object</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">objectList</span><span class="p">():</span>
            <span class="n">instances</span> <span class="o">=</span> <span class="n">instances</span> <span class="o">+</span> <span class="nb">object</span><span class="o">.</span><span class="n">writeXML</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">memo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms</span> <span class="o">+</span> <span class="nb">object</span><span class="o">.</span><span class="n">getXMLAtomOrder</span><span class="p">()</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&lt;/templates&gt;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;universe </span><span class="si">%s</span><span class="s">&gt;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">XMLSpec</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;  &#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">conf</span><span class="o">.</span><span class="n">hasValidPositions</span><span class="p">():</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;  &lt;configuration&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;    &lt;atomArray units=&quot;units:nm&quot;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;    x3=&quot;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="n">atom</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&quot;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;    y3=&quot;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="n">atom</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&quot;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;    z3=&quot;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="n">atom</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&quot;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;    /&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;  &lt;/configuration&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;/universe&gt;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">)</span> 
        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&lt;/molecularsystem&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
       

<span class="c">#</span>
<span class="c"># Infinite universes</span>
<span class="c">#</span></div>
<div class="viewcode-block" id="InfiniteUniverse"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.InfiniteUniverse">[docs]</a><span class="k">class</span> <span class="nc">InfiniteUniverse</span><span class="p">(</span><span class="n">Universe</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Infinite (unbounded and nonperiodic) universe.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forcefield</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">properties</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param forcefield: a force field, or None for no force field</span>
<span class="sd">        :type forcefield: :class:`~MMTK.ForceFields.ForceField.ForceField`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Universe</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forcefield</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_createSpec</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">CdistanceFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">infinite_universe_distance_function</span>
        <span class="k">return</span> <span class="n">infinite_universe_distance_function</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">CcorrectionFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">infinite_universe_correction_function</span>
        <span class="k">return</span> <span class="n">infinite_universe_correction_function</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">CvolumeFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">infinite_universe_volume_function</span>
        <span class="k">return</span> <span class="n">infinite_universe_volume_function</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">CboxTransformationFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_createSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">InfiniteUniverseSpec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span> <span class="o">=</span> <span class="n">InfiniteUniverseSpec</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_descriptionArguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;()&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">XMLSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;topology=&quot;infinite&quot;&#39;</span>

<span class="c">#</span>
<span class="c"># 3D periodic universe base class</span>
<span class="c">#</span></div>
<span class="k">class</span> <span class="nc">Periodic3DUniverse</span><span class="p">(</span><span class="n">Universe</span><span class="p">):</span>

    <span class="n">is_periodic</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiplies all edge lengths by the same factor such that the cell</span>
<span class="sd">        volume becomes equal to the specified value.</span>

<span class="sd">        :param volume: the desired volume</span>
<span class="sd">        :type volume: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">volume</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">cellVolume</span><span class="p">())</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaleSize</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">foldCoordinatesIntoBox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">foldCoordinatesIntoBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">basisVectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">boxToRealCoordinates</span><span class="p">(</span><span class="n">Vector</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">boxToRealCoordinates</span><span class="p">(</span><span class="n">Vector</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">boxToRealCoordinates</span><span class="p">(</span><span class="n">Vector</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">cartesianToFractional</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
        <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reciprocalBasisVectors</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r1</span><span class="o">*</span><span class="n">vector</span><span class="p">,</span> <span class="n">r2</span><span class="o">*</span><span class="n">vector</span><span class="p">,</span> <span class="n">r3</span><span class="o">*</span><span class="n">vector</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">cartesianToFractionalMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reciprocalBasisVectors</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">fractionalToCartesian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
        <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basisVectors</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">e1</span> <span class="o">+</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">e2</span> <span class="o">+</span> <span class="n">array</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">e3</span>

    <span class="k">def</span> <span class="nf">fractionalToCartesianMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basisVectors</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">randomPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boxToRealCoordinates</span><span class="p">(</span><span class="n">Random</span><span class="o">.</span><span class="n">randomPointInBox</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">contiguousObjectOffset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                               <span class="n">box_coordinates</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">contiguous_object_offset</span>
        <span class="k">if</span> <span class="n">objects</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">objects</span> <span class="o">==</span> <span class="bp">self</span> <span class="ow">or</span> <span class="n">objects</span> <span class="o">==</span> <span class="p">[</span><span class="bp">self</span><span class="p">]:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">objectList</span><span class="p">()</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bond_pairs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">conf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fixCellParameters</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">cell_parameters</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">ParticleProperties</span><span class="o">.</span><span class="n">ParticleVector</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pairs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
                <span class="n">new_object</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">ChemicalObjects</span><span class="o">.</span><span class="n">isChemicalObject</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">bondedUnits</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">Collections</span><span class="o">.</span><span class="n">isCollection</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">or</span> <span class="n">isUniverse</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
                    <span class="n">units</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">u</span>
                                 <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">o</span>
                                 <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">topLevelChemicalObject</span><span class="p">()</span>
                                                              <span class="o">.</span><span class="n">bondedUnits</span><span class="p">()])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; not a chemical object&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">bu</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
                    <span class="n">atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">bu</span><span class="o">.</span><span class="n">atomsWithDefinedPositions</span><span class="p">()]</span>
                    <span class="n">mpairs</span> <span class="o">=</span> <span class="n">bu</span><span class="o">.</span><span class="n">traverseBondTree</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">mpairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">mpairs</span>
                              <span class="k">if</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">atoms</span> <span class="ow">and</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mpairs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">mpairs</span> <span class="o">=</span> <span class="n">Utility</span><span class="o">.</span><span class="n">pairs</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
                    <span class="n">new_object</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">pairs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mpairs</span><span class="p">)</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">default</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bond_pairs</span> <span class="o">=</span> <span class="n">pairs</span>
        <span class="k">if</span> <span class="n">cell</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">contiguous_object_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="p">,</span> <span class="n">pairs</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                                     <span class="n">offset</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">box_coordinates</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">contiguous_object_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="p">,</span> <span class="n">pairs</span><span class="p">,</span> <span class="n">conf</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                                     <span class="n">offset</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">box_coordinates</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">offset</span>

    <span class="k">def</span> <span class="nf">_graphics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">distance_fn</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="n">objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objects</span><span class="o">.</span><span class="n">_graphics</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">distance_fn</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span>
                                          <span class="n">module</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basisVectors</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;color&#39;</span><span class="p">,</span> <span class="s">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">material</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">EmissiveMaterial</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">v1</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">))</span>
        <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">v2</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">))</span>
        <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">v1</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">))</span>
        <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">v2</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">))</span>
        <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">v3</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">))</span>
        <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">v1</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">v1</span><span class="o">+</span><span class="n">v3</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">))</span>
        <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">v2</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">))</span>
        <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">))</span>
        <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">v3</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">v1</span><span class="o">+</span><span class="n">v3</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">))</span>
        <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">v3</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">))</span>
        <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">v1</span><span class="o">+</span><span class="n">v3</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">))</span>
        <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">objects</span>

<span class="c">#</span>
<span class="c"># Orthorhombic universe with periodic boundary conditions</span>
<span class="c">#</span>
<div class="viewcode-block" id="OrthorhombicPeriodicUniverse"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.OrthorhombicPeriodicUniverse">[docs]</a><span class="k">class</span> <span class="nc">OrthorhombicPeriodicUniverse</span><span class="p">(</span><span class="n">Periodic3DUniverse</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Periodic universe with orthorhombic elementary cell.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">forcefield</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">properties</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param size: a sequence of length three specifying the edge</span>
<span class="sd">                     lengths along the x, y, and z directions</span>
<span class="sd">        :param forcefield: a force field, or None for no force field</span>
<span class="sd">        :type forcefield: :class:`~MMTK.ForceFields.ForceField.ForceField`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Universe</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forcefield</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,),</span> <span class="n">N</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_createSpec</span><span class="p">()</span>

    <span class="n">is_orthogonal</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">Universe</span><span class="o">.</span><span class="n">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">size</span>

<div class="viewcode-block" id="OrthorhombicPeriodicUniverse.scaleSize"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.OrthorhombicPeriodicUniverse.scaleSize">[docs]</a>    <span class="k">def</span> <span class="nf">scaleSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiplies all edge lengths by a factor.</span>

<span class="sd">        :param factor: the scale factor</span>
<span class="sd">        :type factor: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">foldCoordinatesIntoBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">setCellParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="k">def</span> <span class="nf">realToBoxCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">vector</span>
        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">y</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                      <span class="n">z</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">boxToRealCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">vector</span>
        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                      <span class="n">z</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_realToBoxPointArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="n">N</span><span class="o">.</span><span class="n">NewAxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">array</span><span class="o">/</span><span class="n">parameters</span>

    <span class="k">def</span> <span class="nf">_boxToRealPointArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="n">N</span><span class="o">.</span><span class="n">NewAxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">array</span><span class="o">*</span><span class="n">parameters</span>

    <span class="k">def</span> <span class="nf">CdistanceFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">orthorhombic_universe_distance_function</span>
        <span class="k">return</span> <span class="n">orthorhombic_universe_distance_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">CcorrectionFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">orthorhombic_universe_correction_function</span>
        <span class="k">return</span> <span class="n">orthorhombic_universe_correction_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">CvolumeFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">orthorhombic_universe_volume_function</span>
        <span class="k">return</span> <span class="n">orthorhombic_universe_volume_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">CboxTransformationFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">orthorhombic_universe_box_transformation</span>
        <span class="k">return</span> <span class="n">orthorhombic_universe_box_transformation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">cellParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">reciprocalBasisVectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Vector</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">Vector</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">Vector</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">cellVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">multiply</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">largestDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">minimum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_createSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">OrthorhombicPeriodicUniverseSpec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span> <span class="o">=</span> <span class="n">OrthorhombicPeriodicUniverseSpec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_descriptionArguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;((0.,0.,0.),)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;((0.,0.,0.),</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">XMLSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;topology=&quot;periodic3d&quot; &#39;</span> <span class="o">+</span> \
               <span class="s">&#39;cellshape=&quot;orthorhombic&quot; &#39;</span> <span class="o">+</span> \
               <span class="p">(</span><span class="s">&#39;cellsize=&quot;</span><span class="si">%f</span><span class="s"> </span><span class="si">%f</span><span class="s"> </span><span class="si">%f</span><span class="s">&quot; &#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span> <span class="o">+</span> \
               <span class="s">&#39;units=&quot;units:nm&quot;&#39;</span>

<span class="c">#</span>
<span class="c"># Cubic universe with periodic boundary conditions</span>
<span class="c">#</span></div>
<div class="viewcode-block" id="CubicPeriodicUniverse"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.CubicPeriodicUniverse">[docs]</a><span class="k">class</span> <span class="nc">CubicPeriodicUniverse</span><span class="p">(</span><span class="n">OrthorhombicPeriodicUniverse</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Periodic universe with cubic elementary cell.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CubicPeriodicUniverse.setSize"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.CubicPeriodicUniverse.setSize">[docs]</a>    <span class="k">def</span> <span class="nf">setSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the edge length to a given value.</span>

<span class="sd">        :param size: the new size</span>
<span class="sd">        :type size: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">OrthorhombicPeriodicUniverse</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">size</span><span class="p">,))</span>
</div>
    <span class="k">def</span> <span class="nf">_descriptionArguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;(0.)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;(0.,</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>

<span class="c">#</span>
<span class="c"># Parallelepipedic universe with periodic boundary conditions</span>
<span class="c">#</span></div>
<div class="viewcode-block" id="ParallelepipedicPeriodicUniverse"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.ParallelepipedicPeriodicUniverse">[docs]</a><span class="k">class</span> <span class="nc">ParallelepipedicPeriodicUniverse</span><span class="p">(</span><span class="n">Periodic3DUniverse</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Periodic universe with parallelepipedic elementary cell.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">forcefield</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">properties</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param shape: the basis vectors</span>
<span class="sd">        :type shape: sequence of Scientific.Geometry.Vector</span>
<span class="sd">        :param forcefield: a force field, or None for no force field</span>
<span class="sd">        :type forcefield: :class:`~MMTK.ForceFields.ForceField.ForceField`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Universe</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forcefield</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">19</span><span class="p">,),</span> <span class="n">N</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setShape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_createSpec</span><span class="p">()</span>

    <span class="n">is_periodic</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">setShape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">]))</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">parallelepiped_invert</span>
        <span class="n">parallelepiped_invert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<div class="viewcode-block" id="ParallelepipedicPeriodicUniverse.scaleSize"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.ParallelepipedicPeriodicUniverse.scaleSize">[docs]</a>    <span class="k">def</span> <span class="nf">scaleSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiplies all edge lengths by a factor.</span>

<span class="sd">        :param factor: the scale factor</span>
<span class="sd">        :type factor: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">factor</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">parallelepiped_invert</span>
        <span class="n">parallelepiped_invert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span><span class="o">.</span><span class="n">foldCoordinatesIntoBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">setCellParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameters</span>
            <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">parallelepiped_invert</span>
            <span class="n">parallelepiped_invert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fixCellParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_parameters</span><span class="p">):</span>
        <span class="n">full_parameters</span> <span class="o">=</span> <span class="mf">0.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">full_parameters</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_parameters</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">parallelepiped_invert</span>
        <span class="n">parallelepiped_invert</span><span class="p">(</span><span class="n">full_parameters</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">full_parameters</span>

    <span class="k">def</span> <span class="nf">realToBoxCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">vector</span>
        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">boxToRealCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">vector</span>
        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_realToBoxPointArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">18</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">parameters</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,),</span> <span class="n">N</span><span class="o">.</span><span class="n">Float</span><span class="p">)])</span>
            <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">parallelepiped_invert</span>
            <span class="n">parallelepiped_invert</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">18</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">matrix</span><span class="o">*</span><span class="n">array</span><span class="p">[:,</span> <span class="n">N</span><span class="o">.</span><span class="n">NewAxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_boxToRealPointArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">matrix</span><span class="o">*</span><span class="n">array</span><span class="p">[:,</span> <span class="n">N</span><span class="o">.</span><span class="n">NewAxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">CdistanceFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">parallelepipedic_universe_distance_function</span>
        <span class="k">return</span> <span class="n">parallelepipedic_universe_distance_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">CcorrectionFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">parallelepipedic_universe_correction_function</span>
        <span class="k">return</span> <span class="n">parallelepipedic_universe_correction_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">CvolumeFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">parallelepipedic_universe_volume_function</span>
        <span class="k">return</span> <span class="n">parallelepipedic_universe_volume_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">CboxTransformationFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">parallelepipedic_universe_box_transformation</span>
        <span class="k">return</span> <span class="n">parallelepipedic_universe_box_transformation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">cellParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">reciprocalBasisVectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]),</span>
                <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]),</span>
                <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="p">])]</span>

    <span class="k">def</span> <span class="nf">cellVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">largestDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">([</span><span class="mf">0.5</span><span class="o">/</span><span class="n">v</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reciprocalBasisVectors</span><span class="p">()])</span>

    <span class="k">def</span> <span class="nf">_createSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">MMTK_universe</span> <span class="kn">import</span> <span class="n">ParallelepipedicPeriodicUniverseSpec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spec</span> <span class="o">=</span> <span class="n">ParallelepipedicPeriodicUniverseSpec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_descriptionArguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;((Vector(0.,0.,0.),Vector(0.,0.,0.),Vector(0.,0.,0.)))&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;((Vector(0.,0.,0.),Vector(0.,0.,0.),Vector(0.,0.,0.)),</span><span class="si">%s</span><span class="s">)&#39;</span>\
                   <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcefield</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">XMLSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;topology=&quot;periodic3d&quot; &#39;</span> <span class="o">+</span> \
               <span class="s">&#39;cellshape=&quot;parallelepipedic&quot; &#39;</span> <span class="o">+</span> \
               <span class="p">(</span><span class="s">&#39;cellshape=&quot;</span><span class="si">%f</span><span class="s"> </span><span class="si">%f</span><span class="s"> </span><span class="si">%f</span><span class="s"> </span><span class="si">%f</span><span class="s"> </span><span class="si">%f</span><span class="s"> </span><span class="si">%f</span><span class="s"> </span><span class="si">%f</span><span class="s"> </span><span class="si">%f</span><span class="s"> </span><span class="si">%f</span><span class="s">&quot; &#39;</span>
                <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="mi">9</span><span class="p">]))</span> <span class="o">+</span> \
               <span class="s">&#39;units=&quot;units:nm&quot;&#39;</span>

<span class="c">#</span>
<span class="c"># Recognition functions</span>
<span class="c">#</span></div>
<div class="viewcode-block" id="isUniverse"><a class="viewcode-back" href="../../modules.html#MMTK.Universe.isUniverse">[docs]</a><span class="k">def</span> <span class="nf">isUniverse</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param object: any Python object</span>
<span class="sd">    :returns: True if object is a universe.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">Universe</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">MMTK User Guide 2.7.7 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Konrad Hinsen.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>